## Manual Work

:::: {.columns}

::: {.column style="width: 70%; font-size: 70%;"}

Assemble Submission Pilot 5 files to meet [eCTD specifications](https://www.fda.gov/media/85816/download):

::: {.incremental}
- [x] Create folder structure
- [x] Compile ADRG and cover letter
- [x] Move datasets and programs to correct location
- [x] Update file names to comply with requirements
- [x] Push updates to separate GitHub repository
:::
:::

::: {.column width="30%"}

![](images/ectd_structure.png)
:::

::::

::: {.notes}
Paper with eCTD folder structure graphic https://www.lexjansen.com/phuse-us/2019/sa/SA04.pdf

Easy to make a mistake and miss a key step!
:::

## {background-image="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExczRkYWJnN3ZmYzZsYjZpNWNlNzJ0eWNvMnR2eWRmN3RibXV5MnVzayZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/ReImZejkBnqYU/giphy.gif" background-size="contain"}

::: {.notes}
- Easy to get frustrated while trying to get these pilots actually working
- Credit: https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExczRkYWJnN3ZmYzZsYjZpNWNlNzJ0eWNvMnR2eWRmN3RibXV5MnVzayZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/ReImZejkBnqYU/giphy.gif
:::

## GitHub Actions to the Rescue!

:::: {.columns}

::: {.column width="60%"}

* Run arbritrary commands or **scripts** inside workflow
* Launch on key events (updates to **main** branch) or schedule (cron)
* Perform Git operations on our behalf 

:::

::: {.column width="40%"}

![](images/lego_boss_office.jpg)

:::

::::

::: {.notes}
Image credit: LEGO The Office set https://www.lego.com/en-us/product/the-office-21336
:::


## Bash Scripting

::: {.codewindow style="font-size: 0.42em;"}
create-ectd-bundle.sh
```bash
# Define file and directory paths
ECTD_BUNDLE_DIR=submissions-pilot5-datasetjson-to-fda
ECTD_LETTER_DIR=${ECTD_BUNDLE_DIR}/m1/us
ECTD_ROOT_DIR=${ECTD_BUNDLE_DIR}/m5/datasets/rconsortiumpilot4container/analysis/adam

# additional paths ...

# Create directory structure for ectd bundle
mkdir -p "${ECTD_LETTER_DIR}"
mkdir -p "${ECTD_PROGRAMS_DIR}"
mkdir -p "${ECTD_ADAM_DATASETS_DIR}"
mkdir -p "${ECTD_SDTM_DATASETS_DIR}"

# example: copy helper fcns script
if [ -f "${PROGRAMS_SOURCE_DIR}/pilot5-helper-fcns.r" ]; then
cp "${PROGRAMS_SOURCE_DIR}/pilot5-helper-fcns.r" "${PROGRAMS_DESTINATION_DIR}/."
echo "pilot 5 helper script copied to ${PROGRAMS_DESTINATION_DIR}/pilot5-helper-fcns.r"
fi

# additional operations ...
```
:::

::: footer
[Pilot 5 Create eCTD Bundle Script](https://github.com/RConsortium/submissions-pilot5-datasetjson/blob/main/.github/scripts/create-ectd-bundle.sh)
:::

## Bash Scripting (continued)

::: {.codewindow style="font-size: 0.42em;"}
push-ectd-bundle.sh
```bash
# Set up file paths
ECTD_REPO_DIR=submissions-pilot5-datasetjson-to-fda

# Navigate to clone of ECTD repo
cd "./${ECTD_REPO_DIR}"
echo "Open root of ECTD GitHub Repo"

# Commit updated bundle to repository
git add -A .
git config user.name github-actions
git config user.email github-actions@github.com
git commit -am "GH Action: Update Pilot 5 ECTD bundle"
git push --set-upstream origin main

echo "Updated ECTD bundle successfully to repository"
```
:::

::: footer
[Pilot 5 Push eCTD Bundle Script](https://github.com/RConsortium/submissions-pilot5-datasetjson/blob/main/.github/scripts/push-ectd-bundle.sh)
:::

## GitHub Action Workflow Steps

Run **automatically** on each push to main branch event

::: {.codewindow style="font-size: 0.6em;"}
publish-ectd-bundle.yaml
```yaml
- name: Create ECTD bundle
  run: bash ./.github/scripts/create-ectd-bundle.sh

- name: Archive ECTD bundle
  uses: actions/upload-artifact@v4
  with:
    name: ectd-bundle-archive
    path: submissions-pilot5-datasetjson-to-fda

- name: Push ECTD bundle repository
  run: bash ./.github/scripts/push-ectd-bundle.sh
```
:::

::: footer
[Pilot 5 Publish eCTD Bundle Repository Action](https://github.com/RConsortium/submissions-pilot5-datasetjson/blob/main/.github/workflows/publish-ectd-bundle.yaml)
:::

## Automation for the Win {background-image="images/pilot5_ectd_repo.png" background-size="35%"}

::: footer
[Pilot 5 eCTD Bundle Repository](https://github.com/RConsortium/submissions-pilot5-datasetjson-to-fda)
:::
